<!-- frontend/login.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login | FastAPI Calculator</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <div class="page-container">
    <div class="card">
      <h1>Sign In</h1>
      <p class="subtitle">
        Login with your username or email to access the calculator.
      </p>

      <form id="login-form">
        <div class="form-group">
          <label for="username_or_email">Username or Email</label>
          <input
            id="username_or_email"
            name="username_or_email"
            type="text"
            required
            minlength="3"
          />
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input
            id="password"
            name="password"
            type="password"
            minlength="8"
            required
          />
        </div>

        <button type="submit" class="primary-btn">Login</button>
      </form>

      <p class="small-text">
        Need an account?
        <a href="/static/register.html">Register here</a>
      </p>

      <div id="login-message" class="message"></div>
    </div>
  </div>

  <script>
  const loginForm = document.getElementById("login-form");
  const loginMessageEl = document.getElementById("login-message");

  loginForm.addEventListener("submit", async (event) => {
    event.preventDefault();
    loginMessageEl.textContent = "";
    loginMessageEl.className = "message";

    const username = document
      .getElementById("username_or_email")
      .value.trim();
    const password = document.getElementById("password").value;

    // IMPORTANT CHANGE â†’ tests expect "username", not "username_or_email"
    const payload = { username, password };

    try {
      const resp = await fetch("/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const data = await resp.json();

      if (!resp.ok) {
        loginMessageEl.textContent = data?.detail || "Login failed.";
        loginMessageEl.classList.add("error");
        return;
      }

      localStorage.setItem("access_token", data.access_token);

      loginMessageEl.textContent = data.message || "Login successful!";
      loginMessageEl.classList.add("success");
    } catch (err) {
      loginMessageEl.textContent = "Network error. Please try again.";
      loginMessageEl.classList.add("error");
    }
  });
</script>

</body>
</html>
